# Artificial Citizens

A multi-agent simulation where Non-Player Characters (NPCs) exhibit intelligent behavior including planning, reflection, and dialogue, all powered by Large Language Models (LLMs) from OpenAI. The simulation is visualized in a 2D environment using a React/Konva frontend, with a FastAPI backend managing the simulation logic and data persistence via Supabase.

This project was an exploration into creating dynamic and believable AI-driven characters in a simulated world.

## Core Features

*   **AI-Driven NPCs**: NPCs generate daily plans, make observations, and perform nightly reflections using OpenAI's GPT models.
*   **Memory System**: Memories (plans, observations, reflections) are stored and retrieved, with embeddings for contextual relevance.
*   **Dynamic Dialogues**: NPCs can engage in emergent dialogues when they encounter each other, generated by an LLM.
*   **Real-time Visualization**: A 2D canvas built with React and Konva displays NPC movements, actions (via emojis), and area layouts.
*   **WebSocket Communication**: The frontend receives real-time updates from the backend via WebSockets.
*   **NPC Detail Inspection**: A modal allows users to inspect individual NPC's current state, recent actions, plans, reflections, and memory stream.
*   **Simulation Controls**: Basic controls to reset the simulation state.

## Tech Stack

*   **Backend**:
    *   Python 3.10+
    *   FastAPI (web framework)
    *   Uvicorn (ASGI server)
    *   OpenAI API (for GPT models - planning, reflection, dialogue)
    *   Supabase (PostgreSQL for data, pgvector for embeddings, real-time features initially, now primarily DB)
    *   `python-dotenv` (environment variable management)
    *   `httpx` (HTTP client with retries for Supabase)
*   **Frontend (`ac-web/`)**:
    *   Node.js and pnpm
    *   TypeScript
    *   React 18
    *   Vite (build tool)
    *   Konva.js & `react-konva` (2D canvas rendering)
    *   Zustand (state management)
    *   `date-fns` (time formatting)
*   **Database**: PostgreSQL (via Supabase)

## Project Structure

```
/Users/dhruv/Documents/ai-citizens
├── backend/            # FastAPI application, simulation logic, AI services
├── ac-web/             # React/Vite frontend application
├── docs/               # Project documentation (README, Playbook, Journey)
├── .env.example        # Example environment file (copy to .env)
├── .gitignore          # Root gitignore
├── README.md           # This file
└── requirements.txt    # Python backend dependencies
```

## Setup and Running

### 1. Prerequisites

*   Python 3.10 or later.
*   Node.js (latest LTS version recommended) and `pnpm` (`npm install -g pnpm`).
*   A Supabase account (for PostgreSQL database and API keys).
*   An OpenAI API key with access to GPT models (e.g., GPT-4o, GPT-4o-mini).

### 2. Initial Setup

1.  **Clone the Repository** (if applicable, otherwise ensure you are in the project root directory `/Users/dhruv/Documents/ai-citizens`).
2.  **Environment Variables**:
    *   Copy `.env.example` (if provided, otherwise create a new file) to `.env` in the project root.
    *   Fill in your specific credentials:
        ```env
        SUPABASE_URL="your_supabase_project_url"
        SUPABASE_ANON_KEY="your_supabase_anon_key"
        SUPABASE_SERVICE_KEY="your_supabase_service_key"
        OPENAI_API_KEY="your_openai_api_key"
        ```

### 3. Backend Setup

1.  Navigate to the project root directory.
2.  **Create and activate a Python virtual environment**:
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows: venv\Scripts\activate
    ```
3.  **Install Python dependencies**:
    ```bash
    pip install -r requirements.txt
    ```
4.  **Database Schema Migration & Seeding**:
    *   **Schema**: Go to your Supabase project's SQL Editor.
    *   Execute the SQL statements found in `docs/artificial_citizens_playbook.md` (Phase 1.1) to create the necessary tables and enable the `vector` extension.
    *   **Seed Data**: The `ac-web/scripts/seed.ts` script contains initial data for areas, objects, NPCs, etc. To run it:
        *   You need `ts-node` and `typescript`. If you don't have them globally, you can install them as dev dependencies in `ac-web/`:
            ```bash
            cd ac-web
            pnpm add -D ts-node typescript
            cd ..
            ```
        *   Run the seed script (ensure your `.env` file is populated correctly as the script might use it if adapted, or it uses hardcoded Supabase client init as per original playbook):
            ```bash
            # Ensure environment variables SUPABASE_URL and SUPABASE_SERVICE_KEY from .env are accessible or update script to load them.
            # The original playbook seed script initializes Supabase client directly using process.env.
            # Make sure your shell has these vars set if running like this, or modify seed script to use dotenv.
            # For simplicity, assuming process.env is picked up by ts-node execution if .env is in root and seed.ts uses dotenv or similar.
            pnpm --prefix ac-web ts-node ac-web/scripts/seed.ts 
            ```
            *(Note: The seed script from the playbook uses `process.env.SUPABASE_URL` directly. Ensure these are available in your environment when running, or modify the script to load from `.env` using `dotenv`)*.

### 4. Frontend Setup

1.  Navigate to the frontend directory:
    ```bash
    cd ac-web
    ```
2.  **Install Node.js dependencies**:
    ```bash
    pnpm install
    ```

### 5. Running the Application

1.  **Start the Backend Server**:
    *   Open a terminal in the project root directory.
    *   Ensure your Python virtual environment is activated.
    *   Run:
        ```bash
        uvicorn backend.main:app --reload --port 8000
        ```
    *   The backend should be accessible at `http://localhost:8000`.

2.  **Start the Frontend Development Server**:
    *   Open another terminal and navigate to the `ac-web/` directory.
    *   Run:
        ```bash
        pnpm dev
        ```
    *   The frontend will typically be available at `http://localhost:5173` (Vite will confirm the address).

3.  Open your browser and navigate to the frontend URL (e.g., `http://localhost:5173`).

## Key Documentation

For more detailed information, please refer to:

*   **`docs/artificial_citizens_readme.md`**: A more in-depth overview of the project, core mechanics, and technical architecture.
*   **`docs/artificial_citizens_playbook.md`**: A step-by-step guide detailing the development phases, setup, and key implementation details for building the project from scratch.
*   **`docs/artificial_journey.md`**: (To be created) A narrative detailing the development journey, challenges, and solutions encountered during this specific refactoring and enhancement process.

## Development Notes

*   The simulation uses a tick-based system. The backend `scheduler.py` manages game ticks.
*   NPC behavior is emergent based on their AI-generated plans, observations, and reflections.
*   Extensive refactoring has been done to modularize both backend and frontend code for better maintainability.
